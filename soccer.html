<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="width=device-width,initial-scale=1" name="viewport">
<title>Soccer Team Manager</title>
<script type="text/javascript">
//mobile browser processing is slower than desktop, so a lower pixelDivide increases pixel size and performance
if( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {
	//if mobile do something maybe
}

var teamNames = [
	'Ellie',
	'Ethan',
	'Etienne',
	'Haily',
	'Jack',
	'Jacob',
	'Kelvin',
	'Kevin',
	'Koen',
	'Leah',
	'Misha',
	'Rowan',
	'Taylor',
	'Tenger',
	'Timothy',
	'Cameron',
	'Ian',
	'Juan',
	'Sabine'
];

function millisToMinutesAndSeconds(millis) {
  var minutes = Math.floor(millis / 60000);
  var seconds = ((millis % 60000) / 1000).toFixed(0);
  return (minutes < 10 ? '&nbsp;' : '') + minutes + ":" + (seconds < 10 ? '0' : '') + seconds;
}

function playerScored(key) {
	var container = document.getElementById('main-container');
	container.teamList[key].scored = !container.teamList[key].scored;
	loadBench();
	loadField();
}

function loadBench() {
	var container = document.getElementById('main-container');
	var bench = document.getElementById('bench-list');
	var buildString = '';
	Object.entries(container.bench).forEach(([key, value]) => {
		buildString += `<div style="height:20px;display:inline-flex"><div onclick="playerScored(${key})" style="width:86px;">${value.name}</div><div style="width:20px;font-size:14px;">${(value.scored ? '&#9917;' : '&nbsp;')}</div><div style="width:62px;">${millisToMinutesAndSeconds(value.gameTime)}</div></div>`;
	});
	bench.innerHTML = buildString;
}

function loadField() {
	var container = document.getElementById('main-container');
	var field = document.getElementById('field-list');
	var buildString = '';
	Object.entries(container.field).forEach(([key, value]) => {
		buildString += `<div style="height:20px;display:inline-flex"><div onclick="playerScored(${key})" style="width:86px;">${value.name}</div><div style="width:20px;font-size:14px;">${(value.scored ? '&#9917;' : '&nbsp;')}</div><div style="width:62px;">${millisToMinutesAndSeconds(value.gameTime)}</div></div>`;
	});
	field.innerHTML = buildString;
}

function loadGameTime() {
	var container = document.getElementById('main-container');
	var gameTime = document.getElementById('game-time');
	gameTime.innerHTML = `<span>${millisToMinutesAndSeconds(container.gameTime)}</span>`;
}

function isSetLineupDisabled(event) {
	var container = document.getElementById('main-container');
	var setLineupButton = document.getElementById('set-lineup-button');
	var notSet = false;
	var uniquePlayers = {};
	for (var x=1; x<12; x++) {
		//if duplicate, clear the duplicate and leave the new selection
		if ((event.target.id.toString() !== container.positions[x].id.toString()) && event.target.value.toString() === container.positions[x].value.toString()) {
			container.positions[x].value = '0';
		}
		if (container.positions[x].value === '0') {
			notSet = true;
			container.positions[x].style.borderColor = 'red';
		} else {
			uniquePlayers[container.positions[x].value] = true;
			container.positions[x].style.borderColor = 'black';
		}
	}
	if (!container.clockRunning) {
		setLineupButton.disabled = notSet || Object.entries(uniquePlayers).length !== 11;
	}
	
}

function runTheClock() {
	var container = document.getElementById('main-container');
	if (container.clockRunning) {
		setTimeout(() => {
			//update times then loop
			var nowTime = new Date().getTime();
			var incrementTime = nowTime - container.startTime;
			Object.entries(container.field).forEach(([key, value]) => {
				container.teamList[key].gameTime += incrementTime;
			});
			container.gameTime += incrementTime;
			container.startTime = nowTime;
			loadGameTime();
			loadField();
			runTheClock();
		}, 1000);
	}
}

function startPlay() {
	var container = document.getElementById('main-container');
	container.clockRunning = true;
	container.startTime = new Date().getTime();
	document.getElementById('stop-play-button').disabled = false;
	document.getElementById('start-play-button').disabled = true;
	document.getElementById('set-lineup-button').disabled = true;
	runTheClock();
}

function stopPlay() {
	var container = document.getElementById('main-container');
	container.clockRunning = false;
	document.getElementById('stop-play-button').disabled = true;
	document.getElementById('start-play-button').disabled = false;
	document.getElementById('set-lineup-button').disabled = false;
}

function setLineup() {
	var container = document.getElementById('main-container');
	container.field = {};
	container.bench = {};
	Object.entries(container.positions).forEach(([key, selectObj]) => {
		container.field[selectObj.value] = container.teamList[selectObj.value];
	});
	Object.entries(container.teamList).forEach(([key, value]) => {
		if (!container.field[key]) {
			container.bench[key] = container.teamList[key];
		}
	});
	loadField();
	loadBench();
	document.getElementById('start-play-button').disabled = false;
}

var onConfirmRefresh = function (event) {
  event.preventDefault();
  return event.returnValue = 'Are you sure you want to leave? You will lose this game!';
}

function addShot() {
	var container = document.getElementById('main-container');
	var shotsUs = document.getElementById('shots-us');
	container.shotsByUs += 1;
	shotsUs.innerHTML = container.shotsByUs;
}

function subShot() {
	var container = document.getElementById('main-container');
	var shotsUs = document.getElementById('shots-us');
	container.shotsByUs -= 1;
	if (container.shotsByUs < 0) {
		container.shotsByUs = 0;
	}
	shotsUs.innerHTML = container.shotsByUs;
}

function addAgainst() {
	var container = document.getElementById('main-container');
	var shotsAgainst = document.getElementById('shots-against');
	container.shotsAgainst += 1;
	shotsAgainst.innerHTML = container.shotsAgainst;
}

function subAgainst() {
	var container = document.getElementById('main-container');
	var shotsAgainst = document.getElementById('shots-against');
	container.shotsAgainst -= 1;
	if (container.shotsAgainst < 0) {
		container.shotsAgainst = 0;
	}
	shotsAgainst.innerHTML = container.shotsAgainst;
}

function addSave() {
	var container = document.getElementById('main-container');
	var saves = document.getElementById('saves');
	container.saves += 1;
	saves.innerHTML = container.saves;
}

function subSave() {
	var container = document.getElementById('main-container');
	var saves = document.getElementById('saves');
	container.saves -= 1;
	if (container.saves < 0) {
		container.saves = 0;
	}
	saves.innerHTML = container.saves;
}

function addUs() {
	var container = document.getElementById('main-container');
	var usScore = document.getElementById('us-score');
	container.usScore += 1;
	usScore.innerHTML = container.usScore;
}

function subUs() {
	var container = document.getElementById('main-container');
	var usScore = document.getElementById('us-score');
	container.usScore -= 1;
	if (container.usScore < 0) {
		container.usScore = 0;
	}
	usScore.innerHTML = container.usScore;
}

function addThem() {
	var container = document.getElementById('main-container');
	var themScore = document.getElementById('them-score');
	container.themScore += 1;
	themScore.innerHTML = container.themScore;
}

function subThem() {
	var container = document.getElementById('main-container');
	var themScore = document.getElementById('them-score');
	container.themScore -= 1;
	if (container.themScore < 0) {
		container.themScore = 0;
	}
	themScore.innerHTML = container.themScore;
}

window.addEventListener("beforeunload", onConfirmRefresh, { capture: true });

window.onload = function(){
    var container = document.getElementById('main-container');
    container.style.width = "380px";
	container.style.backgroundColor = 'darkgreen';
    container.style.margin = "0px";
    container.style.padding = "5px";
	container.style.top = 0;
	container.style.left = 0;
	container.style.position = "absolute";
	container.style.borderColor = '#fff';
	container.style.borderStyle = 'solid';
	container.style.borderWidth = '3px';
	container.gameTime = 0;
	container.teamList = {};
	container.shotsByUs = 0;
	container.shotsAgainst = 0;
	container.saves = 0;
	container.usScore = 0;
	container.themScore = 0;
	for (var x=0; x<teamNames.length; x++) {
		var prop = x+1;
		container.teamList[prop] = { name: teamNames[x], gameTime: 0, scored: false };
	}
	container.positions = {};
	for (var x=1; x<12; x++) {
		container.positions[x] = document.createElement('select');
		container.positions[x].id = 'select-box-' + x;
		container.positions[x].onchange = function(event) { isSetLineupDisabled(event); };
		container.positions[x].style.position = 'absolute';
		container.positions[x].style.borderColor = 'red';
		container.positions[x].style.fontSize = '18px';
		var option = document.createElement("option");
		option.value = 0;
		option.text = 'Select...';
		container.positions[x].appendChild(option);
		Object.entries(container.teamList).forEach(([key, value]) => {
			var option = document.createElement("option");
			option.value = key;
			option.text = value['name'];
			container.positions[x].appendChild(option);
		});
		container.appendChild(container.positions[x]);
	}

	//set positions on page
	//atttack
	container.positions[1].style.top = '10px';
	container.positions[1].style.left = '25px';

	container.positions[2].style.top = '10px';
	container.positions[2].style.left = '145px';
	
	container.positions[3].style.top = '10px';
	container.positions[3].style.left = '265px';
	
	//mid field
	container.positions[4].style.top = '50px';
	container.positions[4].style.left = '25px';

	container.positions[5].style.top = '50px';
	container.positions[5].style.left = '145px';
	
	container.positions[6].style.top = '50px';
	container.positions[6].style.left = '265px';

	//back line
	container.positions[7].style.top = '90px';
	container.positions[7].style.left = '25px';

	container.positions[8].style.top = '90px';
	container.positions[8].style.left = '145px';

	container.positions[9].style.top = '90px';
	container.positions[9].style.left = '265px';

	//sweeper
	container.positions[10].style.top = '130px';
	container.positions[10].style.left = '145px';

	//goalie
	container.positions[11].style.top = '170px';
	container.positions[11].style.left = '145px';
	
	container.field = {};
	container.bench = {};
	Object.entries(container.teamList).forEach(([key, value]) => {
		container.bench[key] = container.teamList[key];
	});
	loadField();
	loadBench();
	window.resizeTo(420);
}

</script>
</head>
<body style="background-color:#000;color:#fff;font-size:18px;font-weight:bolder;font-family:Calibri;padding:0;">
	<div id="main-container">
		<div style="height:200px"></div>
		<div style="padding-left:40px;padding-bottom:10px;">
			<button style="font-size:18px;" disabled id="set-lineup-button" onclick="setLineup()">Set Lineup</button>
			<button style="font-size:18px;" disabled id="start-play-button" onclick="startPlay()">Start Play</button>
			<button style="font-size:18px;" disabled id="stop-play-button" onclick="stopPlay()">Stop Play</button>
		</div>
		<div style="display:inline-flex;">
			<div id="score-us" style="display:flex;width:120px;height:70px;border-width:2px;border-color:#fff;border-style:solid;padding:4px;">
				<div style="width:110px;">
					<div style="font-size:26px;">Us &#128038;</div>
					<button style="font-size:18px;width:30px;" onclick="addUs()"> + </button>
					<button style="font-size:18px;width:30px;" onclick="subUs()"> - </button>
				</div>
				<span id='us-score' style="font-size:40px;">0</span>
			</div>
			<div id="game-time" style="width:100px;height:70px;font-size:36px;text-align:center;border-width:2px;border-color:#fff;border-style:solid;padding:4px;">&nbsp;0:00</div>
			<div id="score-them" style="display:flex;width:120px;height:70px;border-width:2px;border-color:#fff;border-style:solid;padding:4px;">
				<div style="width:110px;">
					<div style="font-size:26px;">Them</div>
					<button style="font-size:18px;width:30px;" onclick="addThem()"> + </button>
					<button style="font-size:18px;width:30px;" onclick="subThem()"> - </button>
				</div>
				<span id='them-score' style="font-size:40px;">0</span>
			</div>
		</div>
		<fieldset>
			<legend>Goal Shots</legend>
			<div id="stat-list" style="display:inline-flex;padding-bottom:2px;">
				<div style="width:140px;">Against Us: <span id="shots-against">0</span></div>
				<div style="width:100px;">By Us: <span id="shots-us">0</span></div>
				<div style="width:100px;">Saves: <span id="saves">0</span></div>
			</div>
			<div style="display:inline-flex;">
				<div style="width:140px;">
					<button style="font-size:18px;width:30px;" onclick="addAgainst()"> + </button>
					<button style="font-size:18px;width:30px;" onclick="subAgainst()"> - </button>
				</div>
				<div style="width:100px;">
					<button style="font-size:18px;width:30px;" onclick="addShot()"> + </button>
					<button style="font-size:18px;width:30px;" onclick="subShot()"> - </button>
				</div>
				<div style="width:100px;">
					<button style="font-size:18px;width:30px;" onclick="addSave()"> + </button>
					<button style="font-size:18px;width:30px;" onclick="subSave()"> - </button>
				</div>
			</div>
		</fieldset>
		<fieldset>
			<legend>On Field</legend>
			<div id="field-list"></div>
		</fieldset>
		<fieldset>
			<legend>Bench</legend>
			<div id="bench-list"></div>
		</fieldset>
	</div>
</body>
</html>